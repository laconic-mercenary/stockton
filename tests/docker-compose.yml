version: '3'
services:
  openapiui:
    image: swaggerapi/swagger-ui:v4.14.0
    volumes:
      - ./../gateway/openapi/spec.json:/app/swagger.json
    ports:
      - "8095:8080"
  gateway:
    ports:
      - "8080:8080"
    build:
      context: ../gateway
      dockerfile: Dockerfile
    environment:
      LOG_REQUESTS: "true"
      REQUIRE_SIGNAL_KEY: "true"
      ALLOWED_ORIGIN: "*"
      LOGGING_LEVEL: "debug"
      AUTHORIZATION_TOKEN: "string"
      STORAGE_ADDRESS: "http://storage:80/api/signals"
      STORAGE_TOKEN: "ok"
  storage:
    ports:
      - "8090:80"
    build: 
      context: ../storage
      dockerfile: Dockerfile
    environment:
      - "SIGNAL_EXPIRY=30"
      - "USE_STUBBED_STORAGE=true"
      - "SignalsStorageConnectionString=DefaultEndpointsProtocol=http;AccountName=devstoreaccount1;AccountKey=Eby8vdM02xNOcqFlqUwJPLlmEtlCDXJ1OUzFT50uSRZ6IFsuFq2UVErCz4I6tq/K1SZFPTOtr/KBHBeksoGMGw==;TableEndpoint=http://host.docker.internal:7788/devstoreaccount1;"
